!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports.Kinetophone=e():t.Kinetophone=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){function i(t,e,n){if(null===e||"undefined"==typeof e)throw new Error("You must specify a total duration");r.call(this),t=t||[],n=n||{},this._channels={},this._activeTimingsPerChannel={},this._totalDuration=e,t.forEach(this.addChannel.bind(this)),this._playing=!1,this._timer=new o,this._timer.register(this._timerCallback.bind(this)),this._lastTimerCallback=null,this._tickResolution=n.timeUpdateResolution||33,n.tickImmediately&&setTimeout(function(){this._timerCallback(0)}.bind(this))}var r=n(2),s=n(3),o=n(5);i.prototype=r.prototype,i.prototype.addChannel=function(t){var e=t.name;if(this._channels[e])throw new Error("Duplicate channel name '"+e+"'");var n=new s(this._totalDuration/2),i=t.timings||[];this._channels[e]={name:e,timings:i,tree:n},this._activeTimingsPerChannel[e]=[],i.forEach(function(t){this._addTimingToTree(n,t)}.bind(this))},i.prototype.addTiming=function(t,e){var n=this._channels[t];if(!n)throw new Error("No such channel '"+t+"'");var i=n.tree;this._addTimingToTree(i,e)},i.prototype._addTimingToTree=function(t,e){var n;if("undefined"==typeof e.end&&"undefined"==typeof e.duration)n=e.start+1;else if("undefined"==typeof e.end)n=e.start+e.duration;else{if("undefined"!=typeof e.duration)throw new Error("Cannot specify both 'end' and 'duration'");n=e.end}t.add([e.start,n,{start:e.start,end:n,data:e}])},i.prototype.totalDuration=function(t){if("undefined"==typeof t)return this._totalDuration;if(null===t)throw new Error("You must specify a non-null total duration");this._totalDuration=t,Object.keys(this._channels).forEach(function(t){var e=this._channels[t];delete this._channels[t],this.addChannel({name:e.name,timings:e.timings})}.bind(this))},i.prototype._timerCallback=function(t){null===this._lastTimerCallback?(this.emit("timeupdate",t),this._lastTimerCallback=t,this._resolveTimings(0,t)):t-this._lastTimerCallback>=this._tickResolution&&(this.emit("timeupdate",t),this._resolveTimings(this._lastTimerCallback+1,t),this._lastTimerCallback=t),t>this._totalDuration&&(this.pause(),this._timer.set(0),this._lastTimerCallback=null,this._clearAllTimings(),this.emit("end"))},i.prototype.pause=function(){this._playing&&(this._playing=!1,this.emit("pause"),this._timer.pause())},i.prototype.play=function(){this._playing||(this._timer.currentTime>=this._totalDuration&&(this._timer.set(0),this._lastTimerCallback=null,this._clearAllTimings()),this._playing=!0,this.emit("play"),this._timer.start())},i.prototype.playing=function(){return this._playing},i.prototype.currentTime=function(t){return void 0===t?this._timer.currentTime:(this._lastTimerCallback=t,0>t&&(t=0),t>this._totalDuration&&(t=this._totalDuration),this.emit("seeking",t),this._timer.set(t),this.emit("timeupdate",t),this._resolveTimings(t,t),this.emit("seek",t),void 0)},i.prototype._resolveTimings=function(t,e){Object.keys(this._channels).forEach(function(n){this._resolveTimingsForChannel(n,t,e)}.bind(this))},i.prototype._clearAllTimings=function(){Object.keys(this._channels).forEach(function(t){this._clearAllTimingsForChannel(t)}.bind(this))},i.prototype._resolveTimingsForChannel=function(t,e,n){var i=this._activeTimingsPerChannel[t],r=[],s=e===n?this._channels[t].tree.search(n):this._channels[t].tree.search(e,n);i.forEach(function(e,i){if(n<e.start||n>=e.end){var s={name:t,start:e.start,data:e.data.data};"undefined"!=typeof e.data.data&&(s.data=e.data.data),"undefined"!=typeof e.data.end&&(s.end=e.data.end),"undefined"!=typeof e.data.duration&&(s.duration=e.data.duration),this.emit("exit",s),this.emit("exit:"+t,s),r.unshift(i)}}.bind(this)),r.forEach(function(t){i.splice(t,1)}),s.forEach(function(e){if(e=e.data[2],n>=e.start&&n<e.end&&-1===i.indexOf(e)){var r={name:t,start:e.data.start};"undefined"!=typeof e.data.data&&(r.data=e.data.data),"undefined"!=typeof e.data.end&&(r.end=e.data.end),"undefined"!=typeof e.data.duration&&(r.duration=e.data.duration),this.emit("enter",r),this.emit("enter:"+t,r),i.push(e)}}.bind(this))},i.prototype._clearAllTimingsForChannel=function(t){this._activeTimingsPerChannel[t].forEach(function(e){var n={name:t,start:e.start,data:e.data.data};"undefined"!=typeof e.data.data&&(n.data=e.data.data),"undefined"!=typeof e.data.end&&(n.end=e.data.end),"undefined"!=typeof e.data.duration&&(n.duration=e.data.duration),this.emit("exit",n),this.emit("exit:"+t,n)}.bind(this)),this._activeTimingsPerChannel[t]=[]},t.exports=i},function(t){function e(){}var n=t.exports={};n.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.MutationObserver,n="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};var i=[];if(e){var r=document.createElement("div"),s=new MutationObserver(function(){var t=i.slice();i.length=0,t.forEach(function(t){t()})});return s.observe(r,{attributes:!0}),function(t){i.length||r.setAttribute("yes","no"),i.push(t)}}return n?(window.addEventListener("message",function(t){var e=t.source;if((e===window||null===e)&&"process-tick"===t.data&&(t.stopPropagation(),i.length>0)){var n=i.shift();n()}},!0),function(t){i.push(t),window.postMessage("process-tick","*")}):function(t){setTimeout(t,0)}}(),n.title="browser",n.browser=!0,n.env={},n.argv=[],n.on=e,n.addListener=e,n.once=e,n.off=e,n.removeListener=e,n.removeAllListeners=e,n.emit=e,n.binding=function(){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(){throw new Error("process.chdir is not supported")}},function(t){"use strict";function e(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function n(){}n.prototype._events=void 0,n.prototype.listeners=function(t){if(!this._events||!this._events[t])return[];if(this._events[t].fn)return[this._events[t].fn];for(var e=0,n=this._events[t].length,i=new Array(n);n>e;e++)i[e]=this._events[t][e].fn;return i},n.prototype.emit=function(t,e,n,i,r,s){if(!this._events||!this._events[t])return!1;var o,a,h=this._events[t],u=arguments.length;if("function"==typeof h.fn){switch(h.once&&this.removeListener(t,h.fn,!0),u){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,n),!0;case 4:return h.fn.call(h.context,e,n,i),!0;case 5:return h.fn.call(h.context,e,n,i,r),!0;case 6:return h.fn.call(h.context,e,n,i,r,s),!0}for(a=1,o=new Array(u-1);u>a;a++)o[a-1]=arguments[a];h.fn.apply(h.context,o)}else{var c,f=h.length;for(a=0;f>a;a++)switch(h[a].once&&this.removeListener(t,h[a].fn,!0),u){case 1:h[a].fn.call(h[a].context);break;case 2:h[a].fn.call(h[a].context,e);break;case 3:h[a].fn.call(h[a].context,e,n);break;default:if(!o)for(c=1,o=new Array(u-1);u>c;c++)o[c-1]=arguments[c];h[a].fn.apply(h[a].context,o)}}return!0},n.prototype.on=function(t,n,i){var r=new e(n,i||this);return this._events||(this._events={}),this._events[t]?this._events[t].fn?this._events[t]=[this._events[t],r]:this._events[t].push(r):this._events[t]=r,this},n.prototype.once=function(t,n,i){var r=new e(n,i||this,!0);return this._events||(this._events={}),this._events[t]?this._events[t].fn?this._events[t]=[this._events[t],r]:this._events[t].push(r):this._events[t]=r,this},n.prototype.removeListener=function(t,e,n){if(!this._events||!this._events[t])return this;var i=this._events[t],r=[];if(e&&(i.fn&&(i.fn!==e||n&&!i.once)&&r.push(i),!i.fn))for(var s=0,o=i.length;o>s;s++)(i[s].fn!==e||n&&!i[s].once)&&r.push(i[s]);return r.length?this._events[t]=1===r.length?r[0]:r:delete this._events[t],this},n.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[t]:this._events={},this):this},n.prototype.off=n.prototype.removeListener,n.prototype.addListener=n.prototype.on,n.prototype.setMaxListeners=function(){return this},n.EventEmitter=n,n.EventEmitter2=n,n.EventEmitter3=n,t.exports=n},function(t,e,n){function i(t,e){if(e||(e={}),this.startKey=e.startKey||0,this.endKey=e.endKey||1,this.intervalHash={},this.pointTree=new u({compare:function(t,e){if(null==t)return-1;if(null==e)return 1;var n=t[0]-e[0];return n>0?1:0==n?0:-1}}),this._autoIncrement=0,!t||"number"!=typeof t)throw new Error("you must specify center index as the 2nd argument.");this.root=new a(t,this)}function r(t,e){return e.end<t.idx?(t.left||(t.left=new a(e.start+e.end>>1,this)),r.call(this,t.left,e)):t.idx<e.start?(t.right||(t.right=new a(e.start+e.end>>1,this)),r.call(this,t.right,e)):t.insert(e)}function s(t,e,n){return t?e<t.idx?(t.starts.every(function(t){var i=t.start<=e;return i&&n.push(t.result()),i}),s.call(this,t.left,e,n)):e>t.idx?(t.ends.every(function(t){var i=t.end>=e;return i&&n.push(t.result()),i}),s.call(this,t.right,e,n)):void t.starts.map(function(t){n.push(t.result())}):void 0}function o(t,e,n){if(0>=e-t)throw new Error("end must be greater than start. start: "+t+", end: "+e);var i={},r=[];s.call(this,this.root,t+e>>1,r,!0),r.forEach(function(t){i[t.id]=!0});for(var o=this.pointTree.bsearch([t,null]),a=this.pointTree;o>=0&&a[o][0]==t;)o--;var h=this.pointTree.bsearch([e,null]);if(h>=0){for(var u=a.length-1;u>=h&&a[h][0]<=e;)h++;a.slice(o+1,h).forEach(function(t){var e=t[1];i[e]=!0},this),Object.keys(i).forEach(function(i){var r=this.intervalHash[i];n.push(r.result(t,e))},this)}}function a(t){this.idx=t,this.starts=new u({compare:function(t,e){if(null==t)return-1;if(null==e)return 1;var n=t.start-e.start;return n>0?1:0==n?0:-1}}),this.ends=new u({compare:function(t,e){if(null==t)return-1;if(null==e)return 1;var n=t.end-e.end;return 0>n?1:0==n?0:-1}})}function h(t,e,n,i){if(this.id=e,this.start=t[n],this.end=t[i],this.data=t,"number"!=typeof this.start||"number"!=typeof this.end)throw new Error("start, end must be number. start: "+this.start+", end: "+this.end);if(this.start>=this.end)throw new Error("start must be smaller than end. start: "+this.start+", end: "+this.end)}var u=n(4);i.prototype.add=function(t,e){if(this.intervalHash[e])throw new Error("id "+e+" is already registered.");if(void 0==e){for(;this.intervalHash[this._autoIncrement];)this._autoIncrement++;e=this._autoIncrement}var n=new h(t,e,this.startKey,this.endKey);this.pointTree.insert([n.start,e]),this.pointTree.insert([n.end,e]),this.intervalHash[e]=n,this._autoIncrement++,r.call(this,this.root,n)},i.prototype.search=function(t,e){var n=[];if("number"!=typeof t)throw new Error(t+": invalid input");if(void 0==e)s.call(this,this.root,t,n);else{if("number"!=typeof e)throw new Error(t+","+e+": invalid input");o.call(this,t,e,n)}return n},i.prototype.remove=function(){},a.prototype.insert=function(t){this.starts.insert(t),this.ends.insert(t)},h.prototype.result=function(t,e){var n={id:this.id,data:this.data};if("number"==typeof t&&"number"==typeof e){var i=Math.max(this.start,t),r=Math.min(this.end,e),s=r-i;n.rate1=s/(e-t),n.rate2=s/(this.end-this.start)}return n},t.exports=i},function(t,e){var n,i,r;!function(s,o){i=[],n=o,r="function"==typeof n?n.apply(e,i):n,!(void 0!==r&&(t.exports=r))}(this,function(){var t=function e(){var t=null,n={},i=arguments;["0","1"].forEach(function(e){var r=i[e];Array.isArray(r)?t=r:r&&"object"==typeof r&&(n=r)}),"function"==typeof n.filter&&(this._filter=n.filter),"function"==typeof n.compare?this._compare=n.compare:"string"==typeof n.compare&&e.compares[n.compare]&&(this._compare=e.compares[n.compare]),this._unique=!!n.unique,n.resume&&t?t.forEach(function(t){this.push(t)},this):t&&this.insert.apply(this,t)};return t.create=function(e,n){return new t(e,n)},t.prototype=new Array,t.prototype.constructor=Array.prototype.constructor,t.prototype.insertOne=function(t){var e=this.bsearch(t);return this._unique&&null!=this.key(t,e)?!1:this._filter(t,e)?(this.splice(e+1,0,t),e+1):!1},t.prototype.insert=function(){return Array.prototype.map.call(arguments,function(t){return this.insertOne(t)},this)},t.prototype.remove=function(t){return this.splice(t,1),this},t.prototype.bsearch=function(t){if(!this.length)return-1;for(var e,n=0,i=this.length;i-n>1;){e=Math.floor((n+i)/2),mval=this[e];var r=this._compare(t,mval);if(0==r)return e;r>0?n=e:i=e}return 0==n&&this._compare(this[0],t)>0?-1:n},t.prototype.key=function(t,e){null==e&&(e=this.bsearch(t));var n=e;if(-1==n||this._compare(this[n],t)<0)return n+1<this.length&&0==this._compare(this[n+1],t)?n+1:null;for(;n>=1&&0==this._compare(this[n-1],t);)n--;return n},t.prototype.keys=function(t,e){var n=[];null==e&&(e=this.bsearch(t));for(var i=e;i>=0&&0==this._compare(this[i],t);)n.push(i),i--;var r=this.length;for(i=e+1;r>i&&0==this._compare(this[i],t);)n.push(i),i++;return n.length?n:null},t.prototype.unique=function(t){if(t)return this.filter(function(t,e){return 0==e||0!=this._compare(this[e-1],t)},this);var e=0;return this.map(function(t,n){return 0==n||0!=this._compare(this[n-1],t)?null:n-e++},this).forEach(function(t){null!=t&&this.remove(t)},this),this},t.prototype.toArray=function(){return this.slice()},t.prototype._filter=function(){return!0},t.compares={number:function(t,e){var n=t-e;return n>0?1:0==n?0:-1},string:function(t,e){return t>e?1:t==e?0:-1}},t.prototype._compare=t.compares.string,t})},function(t,e,n){function i(){this.running=!1,this.currentTime=0,this.lastTick=null,this.callbacks=[],this._tick=this._tick.bind(this)}var r=n(7),s=n(6);i.prototype.start=function(t){this.running||(this.running=!0,"undefined"!=typeof t&&this.set(t),this._startTimer())},i.prototype.set=function(t){this.lastTick=null,this.currentTime=t},i.prototype.pause=function(){this.running&&(this.lastTick=null,this.running=!1)},i.prototype._startTimer=function(){this._tick()},i.prototype._tick=function(){if(this.running){if(null===this.lastTick)this.lastTick=s();else{var t=s(),e=t-this.lastTick;this.currentTime=this.currentTime+e,this.lastTick=t}this.callbacks.forEach(function(t){t(this.currentTime)}.bind(this)),r(this._tick)}},i.prototype.register=function(t){this.callbacks.push(t)},i.prototype.unregister=function(t){var e=this.callbacks.indexOf(t);e>-1&&this.callbacks.splice(e,1)},t.exports=i},function(t,e,n){(function(e){(function(){var n,i,r;"undefined"!=typeof performance&&null!==performance&&performance.now?t.exports=function(){return performance.now()}:"undefined"!=typeof e&&null!==e&&e.hrtime?(t.exports=function(){return(n()-r)/1e6},i=e.hrtime,n=function(){var t;return t=i(),1e9*t[0]+t[1]},r=n()):Date.now?(t.exports=function(){return Date.now()-r},r=Date.now()):(t.exports=function(){return(new Date).getTime()-r},r=(new Date).getTime())}).call(this)}).call(e,n(1))},function(t,e,n){for(var i=n(8),r="undefined"==typeof window?{}:window,s=["moz","webkit"],o="AnimationFrame",a=r["request"+o],h=r["cancel"+o]||r["cancelRequest"+o],u=!0,c=0;c<s.length&&!a;c++)a=r[s[c]+"Request"+o],h=r[s[c]+"Cancel"+o]||r[s[c]+"CancelRequest"+o];if(!a||!h){u=!1;var f=0,l=0,p=[],d=1e3/60;a=function(t){if(0===p.length){var e=i(),n=Math.max(0,d-(e-f));f=n+e,setTimeout(function(){var t=p.slice(0);p.length=0;for(var e=0;e<t.length;e++)if(!t[e].cancelled)try{t[e].callback(f)}catch(n){setTimeout(function(){throw n},0)}},Math.round(n))}return p.push({handle:++l,callback:t,cancelled:!1}),l},h=function(t){for(var e=0;e<p.length;e++)p[e].handle===t&&(p[e].cancelled=!0)}}t.exports=function(t){return u?a.call(r,function(){try{t.apply(this,arguments)}catch(e){setTimeout(function(){throw e},0)}}):a.call(r,t)},t.exports.cancel=function(){h.apply(r,arguments)}},function(t,e,n){(function(e){(function(){var n,i,r;"undefined"!=typeof performance&&null!==performance&&performance.now?t.exports=function(){return performance.now()}:"undefined"!=typeof e&&null!==e&&e.hrtime?(t.exports=function(){return(n()-r)/1e6},i=e.hrtime,n=function(){var t;return t=i(),1e9*t[0]+t[1]},r=n()):Date.now?(t.exports=function(){return Date.now()-r},r=Date.now()):(t.exports=function(){return(new Date).getTime()-r},r=(new Date).getTime())}).call(this)}).call(e,n(1))}])});