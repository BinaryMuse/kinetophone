!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Kinetophone=e():t.Kinetophone=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){var i=n(2),r=n(3),s=n(8);t.exports=function(){function t(t,e,n){if(null===e||"undefined"==typeof e)throw new Error("You must specify a total duration");i.call(this),t=t||[],n=n||{},this._channels={},this._activeTimingsPerChannel={},this._totalDuration=e,t.forEach(this.addChannel.bind(this)),this._playing=!1,this._timer=new s,this._timer.register(this._timerCallback.bind(this)),this._lastTimerCallback=null,this._tickResolution=n.timeUpdateResolution||33,n.tickImmediately&&setTimeout(function(){this._timerCallback(0)}.bind(this))}function e(t,e){var n={name:t,start:e.data.start};return"undefined"!=typeof e.data.data&&(n.data=e.data.data),"undefined"!=typeof e.data.end&&(n.end=e.data.end),"undefined"!=typeof e.data.duration&&(n.duration=e.data.duration),n}return t.prototype=i.prototype,t.prototype.addChannel=function(t){var e=t.name;if(this._channels[e])throw new Error("Duplicate channel name '"+e+"'");var n=new r(this._totalDuration/2),i=t.timings||[];this._channels[e]={name:e,timings:i,tree:n},this._activeTimingsPerChannel[e]=[],i.forEach(function(t){this._addTimingToTree(n,t)}.bind(this))},t.prototype.addTiming=function(t,e){var n=this._channels[t];if(!n)throw new Error("No such channel '"+t+"'");var i=n.tree;this._addTimingToTree(i,e)},t.prototype._addTimingToTree=function(t,e){var n;if("undefined"==typeof e.end&&"undefined"==typeof e.duration)n=e.start+1;else if("undefined"==typeof e.end)n=e.start+e.duration;else{if("undefined"!=typeof e.duration)throw new Error("Cannot specify both 'end' and 'duration'");n=e.end}t.add([e.start,n,{start:e.start,end:n,data:e}])},t.prototype.totalDuration=function(t){if("undefined"==typeof t)return this._totalDuration;if(null===t)throw new Error("You must specify a non-null total duration");this._totalDuration=t,Object.keys(this._channels).forEach(function(t){var e=this._channels[t];delete this._channels[t],this.addChannel({name:e.name,timings:e.timings})}.bind(this))},t.prototype._timerCallback=function(t){null===this._lastTimerCallback?(this.emit("timeupdate",t),this._lastTimerCallback=t,this._resolveTimings(0,t)):t-this._lastTimerCallback>=this._tickResolution&&(this.emit("timeupdate",t),this._resolveTimings(this._lastTimerCallback+1,t),this._lastTimerCallback=t),t>this._totalDuration&&(this.pause(),this._timer.set(0),this._lastTimerCallback=null,this._clearAllTimings(),this.emit("end"))},t.prototype.pause=function(){this._playing&&(this._playing=!1,this.emit("pause"),this._timer.pause())},t.prototype.play=function(){this._playing||(this._timer.currentTime>=this._totalDuration&&(this._timer.set(0),this._lastTimerCallback=null,this._clearAllTimings()),this._playing=!0,this.emit("play"),this._timer.start())},t.prototype.playing=function(){return this._playing},t.prototype.currentTime=function(t){return void 0===t?this._timer.currentTime:(this._lastTimerCallback=t,0>t&&(t=0),t>this._totalDuration&&(t=this._totalDuration),this.emit("seeking",t),this._timer.set(t),this.emit("timeupdate",t),this._resolveTimings(t,t),this.emit("seek",t),void 0)},t.prototype.playbackRate=function(t){return void 0===t?this._timer.getRate():(this._timer.setRate(t),void this.emit("rateupdate",t))},t.prototype._resolveTimings=function(t,e){Object.keys(this._channels).forEach(function(n){this._resolveTimingsForChannel(n,t,e)}.bind(this))},t.prototype._clearAllTimings=function(){Object.keys(this._channels).forEach(function(t){this._clearAllTimingsForChannel(t)}.bind(this))},t.prototype._resolveTimingsForChannel=function(t,n,i){var r=this._activeTimingsPerChannel[t],s=[],o=n===i?this._channels[t].tree.search(i):this._channels[t].tree.search(n,i);r.forEach(function(e,n){if(i<e.start||i>=e.end){var r={name:t,start:e.start,data:e.data.data};"undefined"!=typeof e.data.data&&(r.data=e.data.data),"undefined"!=typeof e.data.end&&(r.end=e.data.end),"undefined"!=typeof e.data.duration&&(r.duration=e.data.duration),this.emit("exit",r),this.emit("exit:"+t,r),s.unshift(n)}}.bind(this)),s.forEach(function(t){r.splice(t,1)}),o.forEach(function(n){if(n=n.data[2],i>=n.start&&i<n.end&&-1===r.indexOf(n)){var s=e(t,n);this.emit("enter",s),this.emit("enter:"+t,s),r.push(n)}}.bind(this))},t.prototype._clearAllTimingsForChannel=function(t){this._activeTimingsPerChannel[t].forEach(function(n){var i=e(t,n);this.emit("exit",i),this.emit("exit:"+t,i)}.bind(this)),this._activeTimingsPerChannel[t]=[]},t.prototype.getTimingsAt=function(t,e){var n=function(e){return e.search(t)},i=function(e){return e=e.data[2],t>=e.start&&t<e.end};return this._findTimings(e,i,n)},t.prototype.getTimingsBetween=function(t,e,n){var i=function(n){return n.search(t,e)},r=function(t){return t=t.data[2],e!==t.end};return this._findTimings(n,r,i)},t.prototype._findTimings=function(t,n,i){return t=t||Object.keys(this._channels),"string"==typeof t&&(t=[t]),t.map(function(t){return{name:t,timings:i(this._channels[t].tree).filter(n).map(function(n){return e(t,n.data[2])})}}.bind(this)).reduce(function(t,e){return t[e.name]=e.timings,t},{})},t}()},function(t,e){function n(){u=!1,o.length?h=o.concat(h):c=-1,h.length&&i()}function i(){if(!u){var t=setTimeout(n);u=!0;for(var e=h.length;e;){for(o=h,h=[];++c<e;)o&&o[c].run();c=-1,e=h.length}o=null,u=!1,clearTimeout(t)}}function r(t,e){this.fun=t,this.array=e}function s(){}var o,a=t.exports={},h=[],u=!1,c=-1;a.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];h.push(new r(t,e)),1!==h.length||u||setTimeout(i,0)},r.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=s,a.addListener=s,a.once=s,a.off=s,a.removeListener=s,a.removeAllListeners=s,a.emit=s,a.binding=function(t){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(t,e){"use strict";function n(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function i(){}i.prototype._events=void 0,i.prototype.listeners=function(t){if(!this._events||!this._events[t])return[];if(this._events[t].fn)return[this._events[t].fn];for(var e=0,n=this._events[t].length,i=new Array(n);n>e;e++)i[e]=this._events[t][e].fn;return i},i.prototype.emit=function(t,e,n,i,r,s){if(!this._events||!this._events[t])return!1;var o,a,h=this._events[t],u=arguments.length;if("function"==typeof h.fn){switch(h.once&&this.removeListener(t,h.fn,!0),u){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,n),!0;case 4:return h.fn.call(h.context,e,n,i),!0;case 5:return h.fn.call(h.context,e,n,i,r),!0;case 6:return h.fn.call(h.context,e,n,i,r,s),!0}for(a=1,o=new Array(u-1);u>a;a++)o[a-1]=arguments[a];h.fn.apply(h.context,o)}else{var c,l=h.length;for(a=0;l>a;a++)switch(h[a].once&&this.removeListener(t,h[a].fn,!0),u){case 1:h[a].fn.call(h[a].context);break;case 2:h[a].fn.call(h[a].context,e);break;case 3:h[a].fn.call(h[a].context,e,n);break;default:if(!o)for(c=1,o=new Array(u-1);u>c;c++)o[c-1]=arguments[c];h[a].fn.apply(h[a].context,o)}}return!0},i.prototype.on=function(t,e,i){var r=new n(e,i||this);return this._events||(this._events={}),this._events[t]?this._events[t].fn?this._events[t]=[this._events[t],r]:this._events[t].push(r):this._events[t]=r,this},i.prototype.once=function(t,e,i){var r=new n(e,i||this,!0);return this._events||(this._events={}),this._events[t]?this._events[t].fn?this._events[t]=[this._events[t],r]:this._events[t].push(r):this._events[t]=r,this},i.prototype.removeListener=function(t,e,n){if(!this._events||!this._events[t])return this;var i=this._events[t],r=[];if(e&&(i.fn&&(i.fn!==e||n&&!i.once)&&r.push(i),!i.fn))for(var s=0,o=i.length;o>s;s++)(i[s].fn!==e||n&&!i[s].once)&&r.push(i[s]);return r.length?this._events[t]=1===r.length?r[0]:r:delete this._events[t],this},i.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[t]:this._events={},this):this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.EventEmitter=i,i.EventEmitter2=i,i.EventEmitter3=i,t.exports=i},function(t,e,n){function i(t,e){if(e||(e={}),this.startKey=e.startKey||0,this.endKey=e.endKey||1,this.intervalHash={},this.pointTree=new u({compare:function(t,e){if(null==t)return-1;if(null==e)return 1;var n=t[0]-e[0];return n>0?1:0==n?0:-1}}),this._autoIncrement=0,!t||"number"!=typeof t)throw new Error("you must specify center index as the 2nd argument.");this.root=new a(t,this)}function r(t,e){return e.end<t.idx?(t.left||(t.left=new a(e.start+e.end>>1,this)),r.call(this,t.left,e)):t.idx<e.start?(t.right||(t.right=new a(e.start+e.end>>1,this)),r.call(this,t.right,e)):t.insert(e)}function s(t,e,n){return t?e<t.idx?(t.starts.every(function(t){var i=t.start<=e;return i&&n.push(t.result()),i}),s.call(this,t.left,e,n)):e>t.idx?(t.ends.every(function(t){var i=t.end>=e;return i&&n.push(t.result()),i}),s.call(this,t.right,e,n)):void t.starts.map(function(t){n.push(t.result())}):void 0}function o(t,e,n){if(0>=e-t)throw new Error("end must be greater than start. start: "+t+", end: "+e);var i={},r=[];s.call(this,this.root,t+e>>1,r,!0),r.forEach(function(t){i[t.id]=!0});for(var o=this.pointTree.bsearch([t,null]),a=this.pointTree;o>=0&&a[o][0]==t;)o--;var h=this.pointTree.bsearch([e,null]);if(h>=0){for(var u=a.length-1;u>=h&&a[h][0]<=e;)h++;a.slice(o+1,h).forEach(function(t){var e=t[1];i[e]=!0},this),Object.keys(i).forEach(function(i){var r=this.intervalHash[i];n.push(r.result(t,e))},this)}}function a(t){this.idx=t,this.starts=new u({compare:function(t,e){if(null==t)return-1;if(null==e)return 1;var n=t.start-e.start;return n>0?1:0==n?0:-1}}),this.ends=new u({compare:function(t,e){if(null==t)return-1;if(null==e)return 1;var n=t.end-e.end;return 0>n?1:0==n?0:-1}})}function h(t,e,n,i){if(this.id=e,this.start=t[n],this.end=t[i],this.data=t,"number"!=typeof this.start||"number"!=typeof this.end)throw new Error("start, end must be number. start: "+this.start+", end: "+this.end);if(this.start>=this.end)throw new Error("start must be smaller than end. start: "+this.start+", end: "+this.end)}var u=n(7);i.prototype.add=function(t,e){if(this.intervalHash[e])throw new Error("id "+e+" is already registered.");if(void 0==e){for(;this.intervalHash[this._autoIncrement];)this._autoIncrement++;e=this._autoIncrement}var n=new h(t,e,this.startKey,this.endKey);this.pointTree.insert([n.start,e]),this.pointTree.insert([n.end,e]),this.intervalHash[e]=n,this._autoIncrement++,r.call(this,this.root,n)},i.prototype.search=function(t,e){var n=[];if("number"!=typeof t)throw new Error(t+": invalid input");if(void 0==e)s.call(this,this.root,t,n);else{if("number"!=typeof e)throw new Error(t+","+e+": invalid input");o.call(this,t,e,n)}return n},i.prototype.remove=function(t){},a.prototype.insert=function(t){this.starts.insert(t),this.ends.insert(t)},h.prototype.result=function(t,e){var n={id:this.id,data:this.data};if("number"==typeof t&&"number"==typeof e){var i=Math.max(this.start,t),r=Math.min(this.end,e),s=r-i;n.rate1=s/(e-t),n.rate2=s/(this.end-this.start)}return n},t.exports=i},function(t,e,n){(function(e){(function(){var n,i,r;"undefined"!=typeof performance&&null!==performance&&performance.now?t.exports=function(){return performance.now()}:"undefined"!=typeof e&&null!==e&&e.hrtime?(t.exports=function(){return(n()-r)/1e6},i=e.hrtime,n=function(){var t;return t=i(),1e9*t[0]+t[1]},r=n()):Date.now?(t.exports=function(){return Date.now()-r},r=Date.now()):(t.exports=function(){return(new Date).getTime()-r},r=(new Date).getTime())}).call(this)}).call(e,n(1))},function(t,e,n){for(var i=n(6),r="undefined"==typeof window?{}:window,s=["moz","webkit"],o="AnimationFrame",a=r["request"+o],h=r["cancel"+o]||r["cancelRequest"+o],u=!0,c=0;c<s.length&&!a;c++)a=r[s[c]+"Request"+o],h=r[s[c]+"Cancel"+o]||r[s[c]+"CancelRequest"+o];if(!a||!h){u=!1;var l=0,f=0,p=[],d=1e3/60;a=function(t){if(0===p.length){var e=i(),n=Math.max(0,d-(e-l));l=n+e,setTimeout(function(){var t=p.slice(0);p.length=0;for(var e=0;e<t.length;e++)if(!t[e].cancelled)try{t[e].callback(l)}catch(n){setTimeout(function(){throw n},0)}},Math.round(n))}return p.push({handle:++f,callback:t,cancelled:!1}),f},h=function(t){for(var e=0;e<p.length;e++)p[e].handle===t&&(p[e].cancelled=!0)}}t.exports=function(t){return u?a.call(r,function(){try{t.apply(this,arguments)}catch(e){setTimeout(function(){throw e},0)}}):a.call(r,t)},t.exports.cancel=function(){h.apply(r,arguments)}},function(t,e,n){(function(e){(function(){var n,i,r;"undefined"!=typeof performance&&null!==performance&&performance.now?t.exports=function(){return performance.now()}:"undefined"!=typeof e&&null!==e&&e.hrtime?(t.exports=function(){return(n()-r)/1e6},i=e.hrtime,n=function(){var t;return t=i(),1e9*t[0]+t[1]},r=n()):Date.now?(t.exports=function(){return Date.now()-r},r=Date.now()):(t.exports=function(){return(new Date).getTime()-r},r=(new Date).getTime())}).call(this)}).call(e,n(1))},function(t,e,n){var i,r,s;!function(n,o){r=[],i=o,s="function"==typeof i?i.apply(e,r):i,!(void 0!==s&&(t.exports=s))}(this,function(){var t=function e(){var t=null,n={},i=arguments;["0","1"].forEach(function(e){var r=i[e];Array.isArray(r)?t=r:r&&"object"==typeof r&&(n=r)}),"function"==typeof n.filter&&(this._filter=n.filter),"function"==typeof n.compare?this._compare=n.compare:"string"==typeof n.compare&&e.compares[n.compare]&&(this._compare=e.compares[n.compare]),this._unique=!!n.unique,n.resume&&t?t.forEach(function(t,e){this.push(t)},this):t&&this.insert.apply(this,t)};return t.create=function(e,n){return new t(e,n)},t.prototype=new Array,t.prototype.constructor=Array.prototype.constructor,t.prototype.insertOne=function(t){var e=this.bsearch(t);return this._unique&&null!=this.key(t,e)?!1:this._filter(t,e)?(this.splice(e+1,0,t),e+1):!1},t.prototype.insert=function(){return Array.prototype.map.call(arguments,function(t){return this.insertOne(t)},this)},t.prototype.remove=function(t){return this.splice(t,1),this},t.prototype.bsearch=function(t){if(!this.length)return-1;for(var e,n=0,i=this.length;i-n>1;){e=Math.floor((n+i)/2),mval=this[e];var r=this._compare(t,mval);if(0==r)return e;r>0?n=e:i=e}return 0==n&&this._compare(this[0],t)>0?-1:n},t.prototype.key=function(t,e){null==e&&(e=this.bsearch(t));var n=e;if(-1==n||this._compare(this[n],t)<0)return n+1<this.length&&0==this._compare(this[n+1],t)?n+1:null;for(;n>=1&&0==this._compare(this[n-1],t);)n--;return n},t.prototype.keys=function(t,e){var n=[];null==e&&(e=this.bsearch(t));for(var i=e;i>=0&&0==this._compare(this[i],t);)n.push(i),i--;var r=this.length;for(i=e+1;r>i&&0==this._compare(this[i],t);)n.push(i),i++;return n.length?n:null},t.prototype.unique=function(t){if(t)return this.filter(function(t,e){return 0==e||0!=this._compare(this[e-1],t)},this);var e=0;return this.map(function(t,n){return 0==n||0!=this._compare(this[n-1],t)?null:n-e++},this).forEach(function(t){null!=t&&this.remove(t)},this),this},t.prototype.toArray=function(){return this.slice()},t.prototype._filter=function(t,e){return!0},t.compares={number:function(t,e){var n=t-e;return n>0?1:0==n?0:-1},string:function(t,e){return t>e?1:t==e?0:-1}},t.prototype._compare=t.compares.string,t})},function(t,e,n){function i(){this.running=!1,this.currentTime=0,this.lastTick=null,this.callbacks=[],this._rate=1,this._tick=this._tick.bind(this)}var r=n(5),s=n(4);i.prototype.start=function(t){this.running||(this.running=!0,"undefined"!=typeof t&&this.set(t),this._startTimer())},i.prototype.set=function(t){this.lastTick=null,this.currentTime=t},i.prototype.pause=function(){this.running&&(this.lastTick=null,this.running=!1)},i.prototype.setRate=function(t){this._rate=t},i.prototype.getRate=function(){return this._rate},i.prototype._startTimer=function(){this._tick()},i.prototype._tick=function(){if(this.running){if(null===this.lastTick)this.lastTick=s();else{var t=s(),e=t-this.lastTick;this.currentTime=this.currentTime+e*this._rate,this.lastTick=t}this.callbacks.forEach(function(t){t(this.currentTime)}.bind(this)),r(this._tick)}},i.prototype.register=function(t){this.callbacks.push(t)},i.prototype.unregister=function(t){var e=this.callbacks.indexOf(t);e>-1&&this.callbacks.splice(e,1)},t.exports=i}])});